<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1,user-scalable=no,maximum-scale=1"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="address=no"><meta property="og:title" content="JavaEE Training Note - Day 04"><meta property="og:type" content="article"><meta property="og:url" content="https://jack-q.github.io/blog/2017/02/23/javaee-training-note-day-04/"><meta name="theme-color" content="#d5d5eb"><link rel="manifest" href="/blog/manifest.json"><title>Jack Q's Blog</title><link rel="stylesheet" href="/blog/css/main.css?v=20170818"></head><body><aside class="jq-blog-aside"><header class="jq-nav-header"><div class="nav-bar-toggle" title="toggle sidebar"><span class="toggle-line-1"></span><span class="toggle-line-2"></span><span class="toggle-line-3"></span></div><div class="nav-bar"><div class="nav-bar-icon"><div class="icon"><svg viewBox="0 0 1000 1000" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px">
<polygon points="20,20 250,20 20,250 "/>
<polygon points="325,20 325,400 175,400 175,140 295,20 "/>
<circle cx="249.89" cy="499.769" r="75"/>
<path d="M350,425h150v74.962c0,0,2.72,150.038,150.426,150.038S715,650,715,650v150c0,0,239.892,0-64.574,0 C350.325,800,350,499.962,350,499.962V425z"/>
<circle cx="905" cy="500" r="75"/>
<path d="M605,50v150h75.036c0,0,149.964,2.896,149.964,150.552S830,400,830,400h150c0,0,0,254.915,0-49.448 C980,50.552,680.036,50,680.036,50H605z"/>
<polygon points="738,650 738,800 813,725 "/>
<rect height="100" width="100" x="350" y="300"/>
<path d="M450,403"/>
<rect height="100" width="100" x="477.392" y="50"/>
<rect height="100" width="100" x="411" y="180"/>
<rect height="280" width="150" x="830" y="600"/>
<path d="M175,600h150c0,0,0-120,0,130S75,980,75,980H20V830c0,0-51.286,0,51.857,0S175,730,175,730V600z"/>
<polygon points="980,902 830,902 905,977 "/>
</svg></div><div class="label">Jack Q</div></div></div></header><div class="aside-left"><div class="aside-header"><div class="wrapper"><div class="icon"><svg viewBox="0 0 1000 1000" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px">
<polygon points="20,20 250,20 20,250 "/>
<polygon points="325,20 325,400 175,400 175,140 295,20 "/>
<circle cx="249.89" cy="499.769" r="75"/>
<path d="M350,425h150v74.962c0,0,2.72,150.038,150.426,150.038S715,650,715,650v150c0,0,239.892,0-64.574,0 C350.325,800,350,499.962,350,499.962V425z"/>
<circle cx="905" cy="500" r="75"/>
<path d="M605,50v150h75.036c0,0,149.964,2.896,149.964,150.552S830,400,830,400h150c0,0,0,254.915,0-49.448 C980,50.552,680.036,50,680.036,50H605z"/>
<polygon points="738,650 738,800 813,725 "/>
<rect height="100" width="100" x="350" y="300"/>
<path d="M450,403"/>
<rect height="100" width="100" x="477.392" y="50"/>
<rect height="100" width="100" x="411" y="180"/>
<rect height="280" width="150" x="830" y="600"/>
<path d="M175,600h150c0,0,0-120,0,130S75,980,75,980H20V830c0,0-51.286,0,51.857,0S175,730,175,730V600z"/>
<polygon points="980,902 830,902 905,977 "/>
</svg></div><div class="name">Jack Q</div></div></div><div class="aside-center"><div class="icon-header"><div class="icon-item"><a href="/blog/" data-smooth="data-smooth" data-smooth-type="list"><i class="material-icons">home</i><span class="tooltip">home</span></a></div><div class="icon-item"><span data-content="tag"><i class="material-icons">label_outline</i><span class="tooltip">tag</span></span></div><div class="icon-item"><span data-content="category"><i class="material-icons">folder_open</i><span class="tooltip">category</span></span></div><div class="icon-item"><span data-content="archive"><i class="material-icons">date_range</i><span class="tooltip">archive</span></span></div><div class="icon-item toc-header"><span data-content="content"><i class="material-icons">toc</i><span class="tooltip">content</span></span></div></div><div class="aside-center-content"><section class="aside-tag"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/c/" data-smooth="data-smooth" data-smooth-type="list">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/graphviz/" data-smooth="data-smooth" data-smooth-type="list">GraphViz</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/java/" data-smooth="data-smooth" data-smooth-type="list">Java</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/r/" data-smooth="data-smooth" data-smooth-type="list">R</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/blog/" data-smooth="data-smooth" data-smooth-type="list">blog</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/cas/" data-smooth="data-smooth" data-smooth-type="list">cas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/git/" data-smooth="data-smooth" data-smooth-type="list">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/gpg/" data-smooth="data-smooth" data-smooth-type="list">gpg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/gulp/" data-smooth="data-smooth" data-smooth-type="list">gulp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/hexo/" data-smooth="data-smooth" data-smooth-type="list">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/installation/" data-smooth="data-smooth" data-smooth-type="list">installation</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/java/" data-smooth="data-smooth" data-smooth-type="list">java</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/javascript/" data-smooth="data-smooth" data-smooth-type="list">javascript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/jekyll/" data-smooth="data-smooth" data-smooth-type="list">jekyll</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/linux/" data-smooth="data-smooth" data-smooth-type="list">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/network/" data-smooth="data-smooth" data-smooth-type="list">network</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/npm/" data-smooth="data-smooth" data-smooth-type="list">npm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/python/" data-smooth="data-smooth" data-smooth-type="list">python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/react/" data-smooth="data-smooth" data-smooth-type="list">react</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/requirejs/" data-smooth="data-smooth" data-smooth-type="list">requirejs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/ros/" data-smooth="data-smooth" data-smooth-type="list">ros</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/tex/" data-smooth="data-smooth" data-smooth-type="list">tex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/theme/" data-smooth="data-smooth" data-smooth-type="list">theme</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/visualization/" data-smooth="data-smooth" data-smooth-type="list">visualization</a><span class="tag-list-count">2</span></li></ul></section><section class="aside-category"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/blog/" data-smooth="data-smooth" data-smooth-type="list">blog</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/javascript/" data-smooth="data-smooth" data-smooth-type="list">javascript</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/linux/" data-smooth="data-smooth" data-smooth-type="list">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/network/" data-smooth="data-smooth" data-smooth-type="list">network</a><span class="category-list-count">1</span></li></ul></section><section class="aside-archive"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/08/" data-smooth="data-smooth" data-smooth-type="list"><span>Aug</span><span>2017</span></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/07/" data-smooth="data-smooth" data-smooth-type="list"><span>Jul</span><span>2017</span></a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/05/" data-smooth="data-smooth" data-smooth-type="list"><span>May</span><span>2017</span></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/04/" data-smooth="data-smooth" data-smooth-type="list"><span>Apr</span><span>2017</span></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/03/" data-smooth="data-smooth" data-smooth-type="list"><span>Mar</span><span>2017</span></a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/02/" data-smooth="data-smooth" data-smooth-type="list"><span>Feb</span><span>2017</span></a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/01/" data-smooth="data-smooth" data-smooth-type="list"><span>Jan</span><span>2017</span></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/09/" data-smooth="data-smooth" data-smooth-type="list"><span>Sep</span><span>2015</span></a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/08/" data-smooth="data-smooth" data-smooth-type="list"><span>Aug</span><span>2015</span></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/07/" data-smooth="data-smooth" data-smooth-type="list"><span>Jul</span><span>2015</span></a><span class="archive-list-count">2</span></li></ul></section><section class="aside-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Simple-WebSocket-using-Spring"><span class="toc-text">Simple WebSocket using Spring</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Serving-Frontend-Resource-with-WebJars"><span class="toc-text">Serving Frontend Resource with WebJars</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-setup"><span class="toc-text">Basic setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Version-agnostic-path"><span class="toc-text">Version agnostic path</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Using-SockJS"><span class="toc-text">Using SockJS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STOMP-and-Message-Architecture"><span class="toc-text">STOMP and Message Architecture</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Using-STOMP"><span class="toc-text">Using STOMP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hibernate-with-Spring-MVC"><span class="toc-text">Hibernate with Spring MVC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Layered-Architecture"><span class="toc-text">Layered Architecture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hibernate-as-persistence-layer"><span class="toc-text">Hibernate as persistence layer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sample-service"><span class="toc-text">Sample service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sample-DAO"><span class="toc-text">Sample DAO</span></a></li></ol></li></ol></section></div></div><div class="aside-bottom"><div class="aside-contact"><a class="aside-contact-item" href="https://github.com/Jack-Q/" title="Profile at GitHub" target="_blank"><svg class="aside-github" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a class="aside-contact-item" href="https://www.facebook.com/JackQ2010" title="Profile at Facebook" target="_blank"><svg class="aside-facebook" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a><a class="aside-contact-item" href="https://twitter.com/Jack_Q_2010" title="Profile at Twitter" target="_blank"><svg class="aside-twitter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a class="aside-contact-item" href="mailto:qiaobo@outlook.com?subject=Mail%20from%20blog" title="Send Mail" target="_blank"><svg class="aside-mail" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
<polyline points="22,6 12,13 2,6"></polyline></svg></a></div><div class="aside-copy">2017 &copy; Jack Q</div></div></div></aside><section class="page-loader"><div class="loading-animate"></div><div class="error-animate"><i class="material-icons">error</i><div class="message">Network Error...</div><div class="suggestion">Check your network connection and reload or refresh this page.</div></div></section><section class="article-content" itemscope itemtype="http://schema.org/Article" role="main"><h1 itemprop="name">JavaEE Training Note - Day 04</h1><div class="post-meta"><a class="meta-date" href="/blog/archives/2017/02/" data-smooth="data-smooth" data-smooth-type="list"><span itemprop="datePublished" content="2017-02-23">2017-02-23</span></a><span class="meta-categories"></span><span class="meta-tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/java/" data-smooth="data-smooth" data-smooth-type="list">Java</a></li></ul></span></div><div class="post-content"><p>Today’s first topic is the bi-directional communication with
WebSocket using Spring Framework. By using the <code>SockJS</code> library as well as support on 
server side, some other techniques including the XHR polling and
XHR streaming are provided as fallbacks. The STOMP is a sub-protocol 
under the WebSocket protocol, which use Pub/Sub pattern to manage messages.
Another topic of today is integration of Hibernate into Spring MVC.</p>
<a id="more"></a>
<h2 id="Simple-WebSocket-using-Spring" class="article-heading">Simple WebSocket using Spring<a class="article-anchor" href="#Simple-WebSocket-using-Spring" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h2><p>Begin from version 4 and later, the Spring Framework add some new components to support
WebSocket. First add related dependencies to project. If using Gradle as build tool,
add the following dependency: <code>compile &#39;org.springframework:spring-websocket:4.3.6.RELEASE&#39;</code>
(alternate the version number accordingly).</p>
<p>On the server side, <code>WebSocketHandler</code> can handle the data sent from client and 
send data back to client. Create a new class that extends the <code>TextWebSocketHandler</code>
as a starting point. The following code shows a simple WebSocket handler that echo 
to client what it is received.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> jackq.mvc.handler;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.web.socket.TextMessage;</div><div class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketSession;</div><div class="line"><span class="keyword">import</span> org.springframework.web.socket.handler.TextWebSocketHandler;</div><div class="line"></div><div class="line"><span class="comment">// WebScoket Handler</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WSHandler</span> <span class="keyword">extends</span> <span class="title">TextWebSocketHandler</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleTextMessage</span><span class="params">(WebSocketSession session, TextMessage message)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">super</span>.handleTextMessage(session, message);</div><div class="line">        System.out.println(<span class="string">"WS-HANDLER: Message received"</span>);</div><div class="line">        System.out.println(<span class="string">"Payload: &gt;&gt;&gt; \n"</span> + message.getPayload() + <span class="string">"\n &lt;&lt;&lt;"</span>);</div><div class="line">        <span class="comment">// simple echo server</span></div><div class="line">        session.sendMessage(<span class="keyword">new</span> TextMessage(message.getPayload()));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Then, register the handler to Spring in <code>dispatcher-servlet.xml</code>. </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- dispatcher-servlet.xml --&gt;</span></div><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">       <span class="attr">xmlns:websocket</span>=<span class="string">"http://www.springframework.org/schema/websocket"</span></div><div class="line">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></div><div class="line">            http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">            http://www.springframework.org/schema/context</div><div class="line">            http://www.springframework.org/schema/context/spring-context.xsd</div><div class="line">            http://www.springframework.org/schema/websocket </div><div class="line">            http://www.springframework.org/schema/websocket/spring-websocket.xsd </div><div class="line">            http://www.springframework.org/schema/mvc </div><div class="line">            http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- ... --&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ws-handler"</span> <span class="attr">class</span>=<span class="string">"jackq.mvc.handler.WSHandler"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">websocket:handlers</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- register the handler to '/app/' --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">websocket:mapping</span> <span class="attr">path</span>=<span class="string">"/app/"</span> <span class="attr">handler</span>=<span class="string">"ws-handler"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">websocket:handlers</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Then add some client JavaScript to interact with the server using standard WebSocket API.
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> sock = <span class="keyword">new</span> WebSocket(<span class="string">"ws://localhost:8080/app/"</span>),</div><div class="line">        logNode = <span class="built_in">document</span>.getElementById(<span class="string">"log"</span>),</div><div class="line">        log = <span class="function"><span class="params">l</span> =&gt;</span> logNode.innerHTML += l + <span class="string">'\n'</span>;</div><div class="line"></div><div class="line">    sock.onopen = <span class="function"><span class="params">e</span> =&gt;</span> log(<span class="string">"[OPEN]"</span>);</div><div class="line"></div><div class="line">    sock.onmessage = <span class="function"><span class="params">e</span> =&gt;</span> log(<span class="string">'[RCV]'</span> + e.data);</div><div class="line"></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"send"</span>).onclick = <span class="function"><span class="params">()</span> =&gt;</span>&#123;</div><div class="line">        <span class="keyword">const</span> msg = <span class="built_in">document</span>.getElementById(<span class="string">"msg"</span>).value.trim();</div><div class="line">        log(<span class="string">'[SEND]'</span> + msg);</div><div class="line">        sock.send(msg);</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Add the JavaScript to a webpage contains the following element, then the 
Spring server can response to client when the data is received.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"send"</span>&gt;</span>send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">pre</span> <span class="attr">id</span>=<span class="string">"log"</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Serving-Frontend-Resource-with-WebJars" class="article-heading">Serving Frontend Resource with WebJars<a class="article-anchor" href="#Serving-Frontend-Resource-with-WebJars" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h2><p>Before the configuration of other features relating to WebSocket in Spring, there is 
some preparation work that requires to be done. Since the WebSocket requires 
both the client and server to work together to exchange data bidirectionally,
some browser side components are also vital in the whole program. Therefore,
prepare and serve the client side library is the first thing need to done.</p>
<p>Even though there already are several JavaScript based options to choose, there are also
Java based solutions with tighter integration to Spring server, which including the awesome
WebJars project.</p>
<h3 id="Basic-setup" class="article-heading">Basic setup<a class="article-anchor" href="#Basic-setup" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h3><p>WebJars project repack the frontend library into JARs and manage the dependency relationships
of the packages with maven. For example, the jQuery library can be acquired from the 
following maven coordination: <code>org.webjars:jquery:3.1.0</code>. Add it to build configuration
or download the jar package to classpath (while in this method, the dependencies will not be 
able to resolve automatically).</p>
<p>Next, to access these resources in Spring MVC, use the following pattern: 
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/webjars/jquery/3.1.0/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>And add the resources mapping in Spring MVC configuration file: <code>dispatcher-servlet.xml</code>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/webjars/**"</span> <span class="attr">location</span>=<span class="string">"/webjars/, /resources/"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:cache-control</span> <span class="attr">cache-public</span>=<span class="string">"true"</span> <span class="attr">max-age</span>=<span class="string">"2592000"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Version-agnostic-path" class="article-heading">Version agnostic path<a class="article-anchor" href="#Version-agnostic-path" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h3><p>Since the frontend packages always update frequently, the WebJars provides
a version agnostic path resolver that automatically finds a suitable version
of package. </p>
<p>First, add the following package into project: <code>org.webjars:webjars-locator:0.32</code>.
In a recent update to Spring Framework, the WebJars Locator can be automatically
loaded by Spring. Thus, without no further configuration, just remove the version
number form the package then the magic works.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/webjars/jquery/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Using-SockJS" class="article-heading">Using SockJS<a class="article-anchor" href="#Using-SockJS" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h2><p>As mentioned in the beginning, add <code>SockJS</code> to project to support more browser with some 
fallback techniques when native WebSocket is not available.</p>
<p>First add the client library to project with maven coordination: <code>compile &#39;org.webjars:sockjs-client:1.0.2&#39;</code>.
Then load it into web page with following tag:
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/webjars/sockjs-client/sockjs.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Next update the server to enable support to SockJS protocol. The SockJS protocol add an extra 
step before the handshake of WebSocket to report client capability and negotiate the protocol to 
use. This is done by accessing to an endpoint which append <code>/info</code> to the end of the declared endpoint.
Then the server reply the specific endpoint for suitable protocol to access. The updated handler 
registration will be similar to the following one.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">websocket:handlers</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">websocket:mapping</span> <span class="attr">path</span>=<span class="string">"/app/"</span> <span class="attr">handler</span>=<span class="string">"ws-handler"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- SockJS fallback option --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">websocket:sockjs</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">websocket:handlers</span>&gt;</span></div></pre></td></tr></table></figure>
<p>As a important philosophy of <code>SockJS</code> is to follow the <code>WebSocket</code> API as close as 
possible, there are not much update required to the previous code.
Then replace the <code>WebSocket</code> with <code>SockJS</code> in the client script to meet the server configuration.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="comment">// use the SockJS library </span></div><div class="line">    <span class="comment">// connect to /app/ end point (an http protocol endpint)</span></div><div class="line">    <span class="keyword">const</span> sock = <span class="keyword">new</span> SockJS(<span class="string">"/app/"</span>),</div><div class="line">    </div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="STOMP-and-Message-Architecture" class="article-heading">STOMP and Message Architecture<a class="article-anchor" href="#STOMP-and-Message-Architecture" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h2><p>The WebSocket is a relative lightweight framework that provides few definitions
for formatting and framing message, controlling and managing the connection, etc.,
which is just like the bare TCP protocol that is not quite easy to use.
Just like the HTTP protocol on top of the TCP protocol which provides more functions 
then the TCP and is being used by more users, some sub-protocols 
are also defined to manage message on WebSocket. In the following examples,
the STOMP (Simple Text Oriented Message Protocol) sub-protocol is used as application 
level protocol. </p>
<p>The STOMP protocol create a Pub/Sub (Publisher/Subscriber) pattern across the 
client and server. After a client create a session (a connection between client 
and server) with the server, it can sent message to or subscribe to some message
queue labeled by destination. When a message is pushed into a destination, 
all of the connected subscribers of a destination will receive the message.</p>
<p>To manage the different queues of messages defined in STOMP protocol, Spring 
use message broker to wrap the original based WebSocket or SockJS. Then the message can be 
maintained by a <code>simple-broker</code> provided by Spring or redirect to full featured 
message broker like <code>RabbitMQ</code>. Here, for simplicity, the <code>simple-broker</code> is used.</p>
<p>Since all of the subscribers of a destination will receive the message published in it,
the <code>simple-broker</code> use some conversion to transform the destination name to distinguish
different level of message including broadcast, single-user or point-to-point(single session).
Some rules are listed below:</p>
<ul>
<li><p>Each mapped name within the server can be prefixed in order to prevent conflict with other queue name.
This can be configured with key <code>application-destination-prefix</code> for <code>websocket:message-broker</code>.
For example, a message handler is mapped to <code>/hello</code> in server will handle message 
sent to <code>/app/hello</code> destination when the prefix is configured as <code>/app</code>;</p>
</li>
<li><p>The prefix <code>/topic</code> is used to indicate a broadcast message. By default, the return value of 
a message handler mapped to <code>/hello</code> without extra configuration will be push to destination
<code>/topic/hello</code> which can be subscribed by client;</p>
</li>
<li><p>The prefix <code>/queue</code> is used to indicate a point to point message. </p>
</li>
</ul>
<p>As Spring document illustrated, the prefixed destination have the relationships show in following diagram:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Client Side         Spring Message Handler </div><div class="line">                /app/&lt;dest.&gt;</div><div class="line"> [Message]        |---&gt; [Annotation] --|</div><div class="line"> ---------        |                    |</div><div class="line"> /app/...     ----|                    |</div><div class="line">                     Simple Broker     |</div><div class="line"> /topic/...   ----|                    |</div><div class="line">                  | /topic/&lt;dest.&gt;     |</div><div class="line">                  |---&gt;  [Dest.] &lt;-----|</div><div class="line"> Subscriber &lt;--------------|</div></pre></td></tr></table></figure>
<h2 id="Using-STOMP" class="article-heading">Using STOMP<a class="article-anchor" href="#Using-STOMP" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h2><p>To use STOMP in Spring, first add the configuration at the <code>dispatcher-servlet.xml</code>.
The following code are used to configure the simple broker.
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">       <span class="attr">xmlns:websocket</span>=<span class="string">"http://www.springframework.org/schema/websocket"</span></div><div class="line">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></div><div class="line">            http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">            http://www.springframework.org/schema/context</div><div class="line">            http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/websocket http://www.springframework.org/schema/websocket/spring-websocket.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- other configurations ... --&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">websocket:message-broker</span> <span class="attr">application-destination-prefix</span>=<span class="string">"/app"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">websocket:stomp-endpoint</span> <span class="attr">path</span>=<span class="string">"/message/"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">websocket:sockjs</span> <span class="attr">session-cookie-needed</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">websocket:stomp-endpoint</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">websocket:simple-broker</span> <span class="attr">prefix</span>=<span class="string">"/topic, /queue"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">websocket:message-broker</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Some other packages are required, including Jackson and STOMP client library.
Since the message are encoded in JSON, the Jackson library is used to 
manage the conversion with POJO. The maven coordinations required are 
<code>com.fasterxml.jackson.core:jackson-core:2.8.7</code> and 
<code>com.fasterxml.jackson.core:jackson-databind:2.8.7</code>
 The latter can be acquired from WebJars. The maven coordination required
 is <code>org.webjars:stomp-websocket:2.3.3</code>.</p>
<p>Then the message can be handled in general Spring MVC Controller.
Apart from making response to incoming message, application can 
publish message at any point of the program by using an injected 
<code>SimpMessagingTemplate</code> instance. The following controller shows te </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> jackq.mvc.controller;</div><div class="line"></div><div class="line"><span class="keyword">import</span> jackq.mvc.model.HelloMessage;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.MessageMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.messaging.simp.SimpMessagingTemplate;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class="line"></div><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@RequestMapping</span>(&#123;<span class="string">"/"</span>, <span class="string">"/home/"</span>&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Home</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// Use template to send message at arbitary point </span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SimpMessagingTemplate template;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Home</span><span class="params">(SimpMessagingTemplate template)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.template = template;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">Index</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"home/index"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">Hello</span><span class="params">(@ModelAttribute(<span class="string">"message"</span>)</span> HelloMessage message)</span>&#123;</div><div class="line">        <span class="comment">// Convert a string to the payload of a message </span></div><div class="line">        template.convertAndSend(<span class="string">"/topic/hello"</span>, String.format(<span class="string">"%s says %s"</span>, message.getName(), message.getMessage()));</div><div class="line">        <span class="keyword">return</span> <span class="string">"home/hello"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@MessageMapping</span>(<span class="string">"/hello"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">HelloMessage</span> <span class="params">(HelloMessage message)</span></span>&#123;</div><div class="line">        String greeting =  String.format(<span class="string">"%s says %s"</span>, message.getName(), message.getMessage());</div><div class="line">        System.out.println(greeting);</div><div class="line">        <span class="comment">// This message will be published at /topic/hello</span></div><div class="line">        <span class="keyword">return</span> greeting;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The client JavaScript also need to update to utilize the new message model.
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.ready = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> sock = <span class="keyword">new</span> SockJS(<span class="string">"/message/"</span>),</div><div class="line">        stomp = Stomp.over(sock),</div><div class="line">        log = <span class="function"><span class="params">l</span> =&gt;</span> <span class="built_in">document</span>.getElementById(<span class="string">"log"</span>).innerHTML += l + <span class="string">'\n'</span>;</div><div class="line"></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"send"</span>).onclick = <span class="function"><span class="params">()</span> =&gt;</span>&#123;</div><div class="line">        stomp.send(<span class="string">'/app/hello'</span>, &#123;&#125;, <span class="built_in">JSON</span>.stringify(&#123;</div><div class="line">            <span class="attr">name</span>: <span class="built_in">document</span>.getElementById(<span class="string">"name"</span>).value.trim(),</div><div class="line">            <span class="attr">message</span>: <span class="built_in">document</span>.getElementById(<span class="string">"message"</span>).value.trim()</div><div class="line">        &#125;));</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// Connect to server</span></div><div class="line">    stomp.connect(&#123;&#125;, () =&gt;&#123;</div><div class="line">        <span class="comment">// Subscribe server message </span></div><div class="line">        stomp.subscribe(<span class="string">'/topic/hello'</span>, msg =&gt; log(<span class="string">"[Hello]"</span> + msg.body));</div><div class="line">    &#125;, (err)=&gt;log(err.headers.message));</div><div class="line"></div><div class="line">    <span class="comment">// print debug message</span></div><div class="line">    stomp.debug = <span class="function"><span class="params">msg</span> =&gt;</span> <span class="built_in">document</span>.getElementById(<span class="string">"debug-log"</span>).innerHTML += msg + <span class="string">'\n'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Currently, any connected client can receive message from server when any client 
publish one to the queue or submit it via web from.</p>
<h2 id="Hibernate-with-Spring-MVC" class="article-heading">Hibernate with Spring MVC<a class="article-anchor" href="#Hibernate-with-Spring-MVC" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h2><p>(This is continued on the progress of the last day.)</p>
<h3 id="Layered-Architecture" class="article-heading">Layered Architecture<a class="article-anchor" href="#Layered-Architecture" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h3><p>The general used pattern of Spring MVC application split the application
into multiple layers from top to bottom listed as follows:
(That is form the layer closest to the user client to server)</p>
<ul>
<li><p>the representation layer: including the Spring MVC controller 
and the JSP pages (or other view technologies). Control the appearance of the 
whole application;</p>
</li>
<li><p>the business layer: including the logic for core functionalities of the application. 
These logic are sharable to multiple controllers and generally named as Service;</p>
</li>
<li><p>the persistence layer: including the data access object (DAO) and directly interact with the server;</p>
</li>
<li><p>the entity: object model that holds the data in memory.</p>
</li>
</ul>
<h3 id="Hibernate-as-persistence-layer" class="article-heading">Hibernate as persistence layer<a class="article-anchor" href="#Hibernate-as-persistence-layer" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h3><p>Some beans are required to integrate Hibernate into Spring MVC. The xml definition are listed 
as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- data source --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClassName&#125;"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.user&#125;"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.pass&#125;"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- session factory --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.LocalSessionFactoryBean"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"packagesToScan"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- Package where Hibernate find data model --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>jackq.spring.hibernate.entity<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- hibernate configuration file --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:hibernate.cfg.xml"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- transaction manager --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.HibernateTransactionManager"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- enable annotation based transaction manage --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Sample-service" class="article-heading">Sample service<a class="article-anchor" href="#Sample-service" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h3><p>Service process data and interact with DAOs.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Annotated as Service</span></div><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title">BookService</span> </span>&#123;</div><div class="line">    <span class="comment">// Inject DAO </span></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> BookDao bookDao;</div><div class="line"></div><div class="line">    <span class="comment">// Inject another DAO </span></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> BookLoanDao bookLoanDao;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getBook</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> bookDao.getBookById(id);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> BookCopy <span class="title">getBookCopy</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> bookDao.getBookCopy(id);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Sample-DAO" class="article-heading">Sample DAO<a class="article-anchor" href="#Sample-DAO" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h3><p>A DAO manage actions related to one table.
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Repository annotates a DAO </span></div><div class="line"><span class="meta">@Repository</span></div><div class="line"><span class="comment">// Transactional annotates the manage of transaction</span></div><div class="line"><span class="meta">@Transactional</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title">BookDao</span> </span>&#123;</div><div class="line">    <span class="comment">// Inject session factory</span></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> SessionFactory sessionFactory;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">addBook</span><span class="params">(Book book)</span> </span>&#123;</div><div class="line">        Session currentSession = sessionFactory.getCurrentSession();</div><div class="line">        currentSession.persist(book);</div><div class="line">        <span class="keyword">return</span> book;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">updateBook</span><span class="params">(Book book)</span> </span>&#123;</div><div class="line">        Session currentSession = sessionFactory.getCurrentSession();</div><div class="line">        currentSession.update(book);</div><div class="line">        <span class="keyword">return</span> book;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</div><div class="post-licence" tabindex="0"><div class="post-licence-icon" title="CC-BY-SA 4.0"><i class="cc cc-cc"></i><i class="cc cc-by"></i><i class="cc cc-sa"></i></div><div class="post-licence-text"><div class="post-licence-label">CC-BY-SA 4.0</div>The content of this post is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</div></div><div class="post-content-end">END</div><div class="post-prev-next"><div class="post-prev"><a class="post-prev-link" href="/blog/2017/02/22/javaee-training-note-day-03/" data-smooth="data-smooth" data-smooth-type="post">JavaEE Training Note - Day 03</a></div><div class="post-next"><a class="post-next-link" href="/blog/2017/02/24/javaee-training-note-day-05/" data-smooth="data-smooth" data-smooth-type="post">JavaEE Training Note - Day 05</a></div></div><div class="post-comment"><div id="disqus_thread">Disqus is loading...</div></div><script id="disqus_config" data-disqus-url="https://jack-q.github.io/blog/2017/02/23/javaee-training-note-day-04/" data-disqus-identifier="20170223-JEENOTE-04" data-disqus-title="JavaEE Training Note - Day 04">window.disqus_config = function () {
  var conf = document.getElementById('disqus_config')
  this.page = this.page || {};
  this.page.url = conf.dataset['disqusUrl'];  
  this.page.identifier = conf.dataset['disqusIdentifier'];
  this.page.title = conf.dataset['disqusTitle'];
};</script><script id="disqus_loader">(function() {
  if(document.getElementById('script-disqus')) return;
  var d = document, s = d.createElement('script');
  s.src = '//jackq.disqus.com/embed.js';
  s.id='script-disqus';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script></section><script>if(!window.ga){
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63336636-1', 'auto');
  ga('send', 'pageview');
}
</script><script src="/blog/js/jquery.min.js?v=20170818"></script><script src="/blog/js/main.js?v=20170818"></script></body></html>