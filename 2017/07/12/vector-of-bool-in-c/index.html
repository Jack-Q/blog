<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1,user-scalable=no,maximum-scale=1"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="address=no"><meta property="og:title" content="vector of bool in C++"><meta property="og:type" content="article"><meta property="og:url" content="https://jack-q.github.io/blog/2017/07/12/vector-of-bool-in-c/"><meta name="theme-color" content="#d5d5eb"><link rel="manifest" href="/blog/manifest.json"><title>Jack Q's Blog</title><link rel="stylesheet" href="/blog/css/main.css?v=20170818"></head><body><aside class="jq-blog-aside"><header class="jq-nav-header"><div class="nav-bar-toggle" title="toggle sidebar"><span class="toggle-line-1"></span><span class="toggle-line-2"></span><span class="toggle-line-3"></span></div><div class="nav-bar"><div class="nav-bar-icon"><div class="icon"><svg viewBox="0 0 1000 1000" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px">
<polygon points="20,20 250,20 20,250 "/>
<polygon points="325,20 325,400 175,400 175,140 295,20 "/>
<circle cx="249.89" cy="499.769" r="75"/>
<path d="M350,425h150v74.962c0,0,2.72,150.038,150.426,150.038S715,650,715,650v150c0,0,239.892,0-64.574,0 C350.325,800,350,499.962,350,499.962V425z"/>
<circle cx="905" cy="500" r="75"/>
<path d="M605,50v150h75.036c0,0,149.964,2.896,149.964,150.552S830,400,830,400h150c0,0,0,254.915,0-49.448 C980,50.552,680.036,50,680.036,50H605z"/>
<polygon points="738,650 738,800 813,725 "/>
<rect height="100" width="100" x="350" y="300"/>
<path d="M450,403"/>
<rect height="100" width="100" x="477.392" y="50"/>
<rect height="100" width="100" x="411" y="180"/>
<rect height="280" width="150" x="830" y="600"/>
<path d="M175,600h150c0,0,0-120,0,130S75,980,75,980H20V830c0,0-51.286,0,51.857,0S175,730,175,730V600z"/>
<polygon points="980,902 830,902 905,977 "/>
</svg></div><div class="label">Jack Q</div></div></div></header><div class="aside-left"><div class="aside-header"><div class="wrapper"><div class="icon"><svg viewBox="0 0 1000 1000" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px">
<polygon points="20,20 250,20 20,250 "/>
<polygon points="325,20 325,400 175,400 175,140 295,20 "/>
<circle cx="249.89" cy="499.769" r="75"/>
<path d="M350,425h150v74.962c0,0,2.72,150.038,150.426,150.038S715,650,715,650v150c0,0,239.892,0-64.574,0 C350.325,800,350,499.962,350,499.962V425z"/>
<circle cx="905" cy="500" r="75"/>
<path d="M605,50v150h75.036c0,0,149.964,2.896,149.964,150.552S830,400,830,400h150c0,0,0,254.915,0-49.448 C980,50.552,680.036,50,680.036,50H605z"/>
<polygon points="738,650 738,800 813,725 "/>
<rect height="100" width="100" x="350" y="300"/>
<path d="M450,403"/>
<rect height="100" width="100" x="477.392" y="50"/>
<rect height="100" width="100" x="411" y="180"/>
<rect height="280" width="150" x="830" y="600"/>
<path d="M175,600h150c0,0,0-120,0,130S75,980,75,980H20V830c0,0-51.286,0,51.857,0S175,730,175,730V600z"/>
<polygon points="980,902 830,902 905,977 "/>
</svg></div><div class="name">Jack Q</div></div></div><div class="aside-center"><div class="icon-header"><div class="icon-item"><a href="/blog/" data-smooth="data-smooth" data-smooth-type="list"><i class="material-icons">home</i><span class="tooltip">home</span></a></div><div class="icon-item"><span data-content="tag"><i class="material-icons">label_outline</i><span class="tooltip">tag</span></span></div><div class="icon-item"><span data-content="category"><i class="material-icons">folder_open</i><span class="tooltip">category</span></span></div><div class="icon-item"><span data-content="archive"><i class="material-icons">date_range</i><span class="tooltip">archive</span></span></div><div class="icon-item toc-header"><span data-content="content"><i class="material-icons">toc</i><span class="tooltip">content</span></span></div></div><div class="aside-center-content"><section class="aside-tag"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/c/" data-smooth="data-smooth" data-smooth-type="list">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/graphviz/" data-smooth="data-smooth" data-smooth-type="list">GraphViz</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/java/" data-smooth="data-smooth" data-smooth-type="list">Java</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/r/" data-smooth="data-smooth" data-smooth-type="list">R</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/blog/" data-smooth="data-smooth" data-smooth-type="list">blog</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/cas/" data-smooth="data-smooth" data-smooth-type="list">cas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/git/" data-smooth="data-smooth" data-smooth-type="list">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/gpg/" data-smooth="data-smooth" data-smooth-type="list">gpg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/gulp/" data-smooth="data-smooth" data-smooth-type="list">gulp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/hexo/" data-smooth="data-smooth" data-smooth-type="list">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/installation/" data-smooth="data-smooth" data-smooth-type="list">installation</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/java/" data-smooth="data-smooth" data-smooth-type="list">java</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/javascript/" data-smooth="data-smooth" data-smooth-type="list">javascript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/jekyll/" data-smooth="data-smooth" data-smooth-type="list">jekyll</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/linux/" data-smooth="data-smooth" data-smooth-type="list">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/network/" data-smooth="data-smooth" data-smooth-type="list">network</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/npm/" data-smooth="data-smooth" data-smooth-type="list">npm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/python/" data-smooth="data-smooth" data-smooth-type="list">python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/react/" data-smooth="data-smooth" data-smooth-type="list">react</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/requirejs/" data-smooth="data-smooth" data-smooth-type="list">requirejs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/ros/" data-smooth="data-smooth" data-smooth-type="list">ros</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/tex/" data-smooth="data-smooth" data-smooth-type="list">tex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/theme/" data-smooth="data-smooth" data-smooth-type="list">theme</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/visualization/" data-smooth="data-smooth" data-smooth-type="list">visualization</a><span class="tag-list-count">2</span></li></ul></section><section class="aside-category"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/blog/" data-smooth="data-smooth" data-smooth-type="list">blog</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/javascript/" data-smooth="data-smooth" data-smooth-type="list">javascript</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/linux/" data-smooth="data-smooth" data-smooth-type="list">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/network/" data-smooth="data-smooth" data-smooth-type="list">network</a><span class="category-list-count">1</span></li></ul></section><section class="aside-archive"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/08/" data-smooth="data-smooth" data-smooth-type="list"><span>Aug</span><span>2017</span></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/07/" data-smooth="data-smooth" data-smooth-type="list"><span>Jul</span><span>2017</span></a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/05/" data-smooth="data-smooth" data-smooth-type="list"><span>May</span><span>2017</span></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/04/" data-smooth="data-smooth" data-smooth-type="list"><span>Apr</span><span>2017</span></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/03/" data-smooth="data-smooth" data-smooth-type="list"><span>Mar</span><span>2017</span></a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/02/" data-smooth="data-smooth" data-smooth-type="list"><span>Feb</span><span>2017</span></a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/01/" data-smooth="data-smooth" data-smooth-type="list"><span>Jan</span><span>2017</span></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/09/" data-smooth="data-smooth" data-smooth-type="list"><span>Sep</span><span>2015</span></a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/08/" data-smooth="data-smooth" data-smooth-type="list"><span>Aug</span><span>2015</span></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/07/" data-smooth="data-smooth" data-smooth-type="list"><span>Jul</span><span>2015</span></a><span class="archive-list-count">2</span></li></ul></section><section class="aside-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Synopsis"><span class="toc-text">Synopsis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Specialized-reference-type"><span class="toc-text">Specialized reference type</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#More-resources"><span class="toc-text">More resources</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#implementation"><span class="toc-text">implementation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#workaround-for-inadequate-scenario"><span class="toc-text">workaround for inadequate scenario</span></a></li></ol></li></ol></section></div></div><div class="aside-bottom"><div class="aside-contact"><a class="aside-contact-item" href="https://github.com/Jack-Q/" title="Profile at GitHub" target="_blank"><svg class="aside-github" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a class="aside-contact-item" href="https://www.facebook.com/JackQ2010" title="Profile at Facebook" target="_blank"><svg class="aside-facebook" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a><a class="aside-contact-item" href="https://twitter.com/Jack_Q_2010" title="Profile at Twitter" target="_blank"><svg class="aside-twitter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a class="aside-contact-item" href="mailto:qiaobo@outlook.com?subject=Mail%20from%20blog" title="Send Mail" target="_blank"><svg class="aside-mail" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
<polyline points="22,6 12,13 2,6"></polyline></svg></a></div><div class="aside-copy">2017 &copy; Jack Q</div></div></div></aside><section class="page-loader"><div class="loading-animate"></div><div class="error-animate"><i class="material-icons">error</i><div class="message">Network Error...</div><div class="suggestion">Check your network connection and reload or refresh this page.</div></div></section><section class="article-content" itemscope itemtype="http://schema.org/Article" role="main"><h1 itemprop="name">vector of bool in C++</h1><div class="post-meta"><a class="meta-date" href="/blog/archives/2017/07/" data-smooth="data-smooth" data-smooth-type="list"><span itemprop="datePublished" content="2017-07-12">2017-07-12</span></a><span class="meta-categories"></span><span class="meta-tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/c/" data-smooth="data-smooth" data-smooth-type="list">C++</a></li></ul></span></div><div class="post-content"><p>C++ is an evolvement of C with shared design principles of performance first, 
yet with consideration of convenience at the perspective of programmer. 
However, the former generally requires to implement the most suitable and 
dedicated data structure (that is to optimize) for common cases. The specialization
results in inconsistency. This post is mainly about the <code>vector</code> of <code>bool</code>, which is 
a specialization of <code>vector</code> according to the standard template library (STL) of C++.</p>
<a id="more"></a>
<h2 id="Synopsis" class="article-heading">Synopsis<a class="article-anchor" href="#Synopsis" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h2><p>In C++, <code>bool</code> is a primitive type used to represent logical value (boolean value).
For most compiling systems, the size of type <code>bool</code> is a single byte, 
yet the size of information that a <code>bool</code> value can express is only 1 bit, which is 
constrained by the architecture of computer system for which the minimal addressable
memory unit is one byte. </p>
<p>However, for a serial of <code>bool</code> variables, they can be stored as bit filed, in which 
each variable requires a single bit. The <code>std::vector&lt;bool&gt;</code> is a specialization of 
class template <code>std::vector&lt;T&gt;</code> which use this technique to decrease memory usage.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> BOOL;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">void</span> <span class="title">testVector</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</div><div class="line">  <span class="comment">// this is an GCC extension to inspect memory allocation status</span></div><div class="line">  malloc_stats();</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;T&gt; tVec(size);</div><div class="line">  malloc_stats();</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="keyword">sizeof</span>(tVec) &lt;&lt; <span class="string">'\t'</span> &lt;&lt; <span class="keyword">sizeof</span>(<span class="keyword">bool</span>) &lt;&lt; <span class="string">'\t'</span> &lt;&lt; tVec.capacity() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</div><div class="line">                          <span class="comment">// malloc  vector  element  capacity</span></div><div class="line">  testVector&lt;<span class="keyword">bool</span>&gt;(<span class="number">32</span>);   <span class="comment">//   32      40      1         64</span></div><div class="line">  testVector&lt;<span class="keyword">bool</span>&gt;(<span class="number">128</span>);  <span class="comment">//   32      40      1        128</span></div><div class="line">  testVector&lt;<span class="keyword">bool</span>&gt;(<span class="number">1024</span>); <span class="comment">//  144      40      1       1024</span></div><div class="line">  testVector&lt;BOOL&gt;(<span class="number">32</span>);   <span class="comment">//   48      24      1         32</span></div><div class="line">  testVector&lt;BOOL&gt;(<span class="number">128</span>);  <span class="comment">//  144      24      1        128</span></div><div class="line">  testVector&lt;BOOL&gt;(<span class="number">1024</span>); <span class="comment">// 1040      24      4       1024</span></div><div class="line">  testVector&lt;<span class="keyword">int</span>&gt;(<span class="number">32</span>);    <span class="comment">//  144      24      4         64</span></div><div class="line">  testVector&lt;<span class="keyword">int</span>&gt;(<span class="number">128</span>);   <span class="comment">//  528      24      4        128</span></div><div class="line">  testVector&lt;<span class="keyword">int</span>&gt;(<span class="number">1024</span>);  <span class="comment">// 4112      24      4       1024</span></div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>From the statistics of memory usage of <code>std::vector&lt;bool&gt;</code> and <code>std::vector&lt;BOOL&gt;</code> (<code>BOOL</code> is an alias of <code>unsigned char</code>),
the total memory usage of boolean vector is much less then integer vector. Each element is stored as a single bit in vector.</p>
<h2 id="Specialized-reference-type" class="article-heading">Specialized reference type<a class="article-anchor" href="#Specialized-reference-type" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h2><p>A canonical name of the element type of the vector of bool is 
<code>std::_Bit_reference</code> (error message from compiler can help a lot), which is an access proxy 
of bit filed in vector. The proxy can be read and written just like a reference of 
an bool variable though is cannot be converted directly to an reference of <code>bool</code>. 
A related error message of this problem is quoted here for reference.</p>
<blockquote>
<p>note: candidate function not viable: no known conversion from ‘<code>reference</code>‘ (aka ‘<code>std::_Bit_reference</code>‘) to ‘<code>bool &amp;</code>‘ for 1st argument</p>
</blockquote>
<p>Consider the following program which applies utilities functions in STL (from <code>algorithm</code> header)
on <code>vector</code> of <code>bool</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> vector_size = <span class="number">10</span>;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">bool</span> <span class="title">any_of</span>(<span class="title">std</span>:</span>:<span class="built_in">vector</span>&lt;T&gt; &amp;vec) &#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::any_of(vec.begin(), vec.end(), [](T &amp;i)&#123;</div><div class="line">    <span class="keyword">return</span> !i;</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; bVec(vector_size);</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vector_size; i++) &#123;</div><div class="line">     bVec[i] = i % <span class="number">2</span> + <span class="number">1</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span>(any_of(bVec)) &#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"some elements in array are not true"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"all of elements in array are true"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="built_in">std</span>::fill(bVec.begin(), bVec.end(), <span class="number">0</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This program won’t pass the compiling since the element type of <code>bVec</code> is not <code>bool</code>, thus
the parameter of lambda in function template <code>any_of</code> cannot be expressed as <code>T &amp;</code>.
However, for other specializations of <code>vector</code>, the function template just works fine.</p>
<p>A simple solution for this template is use <code>auto</code> (C++ 11) keyword to enable automatic type derivation.
The function template can be changed to the following code.
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt; <span class="title">bool</span> <span class="title">any_of</span>(<span class="title">std</span>:</span>:<span class="built_in">vector</span>&lt;T&gt; &amp;vec) &#123;</div><div class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::any_of(vec.begin(), vec.end(), [](<span class="keyword">auto</span> i)&#123;</div><div class="line">    <span class="keyword">return</span> !i;</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>The compiler will derivate the type of <code>i</code> to <code>T &amp;</code> or <code>std::_Bit_reference</code> accordingly.</p>
<h2 id="More-resources" class="article-heading">More resources<a class="article-anchor" href="#More-resources" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h2><h3 id="implementation" class="article-heading">implementation<a class="article-anchor" href="#implementation" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h3><p>For a sample implementation of vector of bool in C++, the source of the <code>libstdc++</code>
project of GCC is accessible from it repo 
(or its <a href="https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/stl_bvector.h" target="_blank" rel="external">GitHub Mirror</a>)</p>
<p>A section of comments in GCC’s implementation of boolean vector describes the conflicts of 
this specialization of vector with standard container implementation. (<a href="https://github.com/gcc-mirror/gcc/blob/9839559a054268dd444639141d9a7a7c7e6622a9/libstdc%2B%2B-v3/include/bits/stl_bvector.h#L567-L585" target="_blank" rel="external">link</a>).</p>
<p>In general, this implementation use a dedicate iterator as proxy for bit field access.
The proxy can be read or written just as a primitive pointer of <code>bool</code>, yet it is completely a different type.
For certain scenarios in which the proxy is assigned to a variable, the program will fail to 
compile.</p>
<h3 id="workaround-for-inadequate-scenario" class="article-heading">workaround for inadequate scenario<a class="article-anchor" href="#workaround-for-inadequate-scenario" data-smooth="" data-smooth-type="post" aria-hidden="true"></a></h3><p>Sometimes, this inconsistency of this specialization may cause generic program applied to standard container 
cannot be compiled. Here are some options to be used as workaround for this problem.</p>
<ul>
<li>Use <code>deque</code> as a container for <code>bool</code>;</li>
<li>Use pinter of <code>bool</code> (<code>bool *</code>) as element of <code>vector</code>;</li>
<li>Use <code>unsigned short</code>, <code>BOOL</code>, or other integer type as element of the container;</li>
<li>Use a wrapper class / structure as a container of primitive <code>bool</code> type as element of <code>vector</code>.</li>
</ul>
</div><div class="post-licence" tabindex="0"><div class="post-licence-icon" title="CC-BY-SA 4.0"><i class="cc cc-cc"></i><i class="cc cc-by"></i><i class="cc cc-sa"></i></div><div class="post-licence-text"><div class="post-licence-label">CC-BY-SA 4.0</div>The content of this post is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</div></div><div class="post-content-end">END</div><div class="post-prev-next"><div class="post-prev"><a class="post-prev-link" href="/blog/2017/07/12/service-in-ros/" data-smooth="data-smooth" data-smooth-type="post">Service in ROS</a></div><div class="post-next"><a class="post-next-link" href="/blog/2017/07/30/install-global-npm-package-for-current-user-without-privilege/" data-smooth="data-smooth" data-smooth-type="post">Install Global npm Package For Current User Without Privilege</a></div></div><div class="post-comment"><div id="disqus_thread">Disqus is loading...</div></div><script id="disqus_config" data-disqus-url="https://jack-q.github.io/blog/2017/07/12/vector-of-bool-in-c/" data-disqus-identifier="20170712-CPPBVEC" data-disqus-title="vector of bool in C++">window.disqus_config = function () {
  var conf = document.getElementById('disqus_config')
  this.page = this.page || {};
  this.page.url = conf.dataset['disqusUrl'];  
  this.page.identifier = conf.dataset['disqusIdentifier'];
  this.page.title = conf.dataset['disqusTitle'];
};</script><script id="disqus_loader">(function() {
  if(document.getElementById('script-disqus')) return;
  var d = document, s = d.createElement('script');
  s.src = '//jackq.disqus.com/embed.js';
  s.id='script-disqus';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script></section><script>if(!window.ga){
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63336636-1', 'auto');
  ga('send', 'pageview');
}
</script><script src="/blog/js/jquery.min.js?v=20170818"></script><script src="/blog/js/main.js?v=20170818"></script></body></html>